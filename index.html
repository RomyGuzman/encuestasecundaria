<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encuesta </title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
        }
        .container {
            width: 100%;
            max-width: 500px;
            background: #fff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            animation: fadeIn 0.5s ease-in-out;
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
        }
        h2 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #444;
        }
        .option {
            display: block;
            margin: 10px 0;
            padding: 14px;
            border: 2px solid #2575fc;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            position: relative;
            user-select: none;
        }
        .option:hover {
            background: #2575fc;
            color: white;
        }
        .option.selected {
            background: #2575fc !important;
            color: #fff !important;
            border-color: #2575fc !important;
        }
    
        input[type="radio"],
        input[type="checkbox"] {
            display: none;
        }
        button {
            margin-top: 15px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%);
            color: white;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
        }
        button:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }
        .back-btn {
            background: #ddd !important;
            color: #333 !important;
            margin-right: 10px;
        }
        .back-btn:hover {
            background: #ccc !important;
            transform: scale(1.02);
        }
        .progress-bar {
            height: 8px;
            background: #ddd;
            border-radius: 6px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress {
            height: 8px;
            background: linear-gradient(135deg, #2575fc, #6a11cb);
            width: 0;
            transition: width 0.4s ease;
        }
       
        .spinner div {
            width: 16px;
            height: 16px;
            margin: 0 4px;
            background: #2575fc;
            border-radius: 50%;
            animation: bounce 0.6s infinite alternate;
        }
        .spinner div:nth-child(2) {
            animation-delay: 0.2s;
        }
        .spinner div:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes bounce {
            to {
                transform: translateY(-12px);
                opacity: 0.7;
            }
        }
        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .button-group button {
            flex: 1;
            margin: 0 5px;
        }
        .final-message {
            text-align: center;
            font-size: 1rem;
            line-height: 1.5;
        }
        .final-message a {
            color: #2575fc;
            text-decoration: underline;
        }
        .multi-select-info {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ENCUESTA</h1>
        <div style="text-align:right; margin-bottom:10px;">
            <label for="lang">Idioma:</label>
            <select id="lang" onchange="cambiarIdioma(this.value)">
                <option value="es">Español</option>
                <option value="en">English</option>
                <option value="zh">中文</option>
            </select>
        </div>
        <div class="progress-bar"><div id="progress" class="progress"></div></div>
        <div id="quiz"></div>
    </div>
    <script>
           // Webhook URL - REEMPLAZA CON TU URL REAL (ngrok o server)
   const N8N_WEBHOOK_URL = 'https://eb6d59a43817.ngrok-free.app/webhook/Survey2';  // Nuevo path para segunda
   
        
        // Traducciones de preguntas y opciones
        const traducciones = {
            es: [
                { pregunta: "Edad: selecciona tu edad", opciones: ["12", "13", "14", "15", "16", "17"] },
                { pregunta: "Género", opciones: ["Femenino", "Masculino", "Otro"] },
                { pregunta: "¿Has apostado en línea alguna vez?", opciones: ["Sí", "No"] },
                { pregunta: "¿Con qué frecuencia sueles apostar?", opciones: ["1 a 2 días por semana", "3 a 5 días por semana", "6 a 7 días por semana"] },
                { pregunta: "¿Cuántas horas apostás por día?", opciones: ["Menos de 1 hora", "1 a 2 horas", "Más de 3 horas"] },
                { pregunta: "¿Qué días de la semana sueles apostar?", opciones: ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo"] },
                { pregunta: "¿En qué tipo de actividades apuestas?", opciones: ["Casino online", "Apuestas deportivas", "Póker u otros juegos de cartas", "Juegos de azar (ruleta, tragamonedas, etc.)", "Otro"] },
                { pregunta: "¿Los sitios de apuestas en los que juegas son oficiales (.bet)?", opciones: ["Sí", "No", "No sé"] },
                { pregunta: "¿De dónde obtienes el dinero para apostar?", opciones: ["Un familiar", "Trabajo", "Becas", "Otro"] },
                { pregunta: "¿Cuánto dinero sueles apostar en una semana?", opciones: ["Entre $1.000 y $5.000", "Entre $5.000 y $10.000", "Más de $10.000"] },
                { pregunta: "¿Tus padres o tutores saben que apuestas?", opciones: ["Sí", "No", "No estoy seguro"] },
                { pregunta: "¿Cómo conociste los juegos en línea?", opciones: ["Redes sociales", "Amigos", "Familia", "Otro"] },
                { pregunta: "¿Por qué apuestas?", opciones: ["Diversión o entretenimiento", "Para ganar dinero", "Porque mis amigos lo hacen", "Otro"] },
                { pregunta: "¿Conoces los riesgos de apostar?", opciones: ["Sí", "No"] },
                { pregunta: "¿Sabes a dónde acudir o qué hacer si tuvieras un problema con las apuestas?", opciones: ["Sí", "No"] },
                { pregunta: "¿Te gustaría recibir información al respecto?", opciones: ["Sí", "No"] },
                { pregunta: "¿Conoces a alguien que apueste en línea?", opciones: ["Sí", "No"] },
                { pregunta: "¿Alguien te ha recomendado apostar alguna vez?", opciones: ["Sí", "No"] },
                { pregunta: "¿Te gustaría apostar algún día?", opciones: ["Sí", "No", "No estoy seguro"] },
                { pregunta: "¿Conoces los riesgos de apostar?", opciones: ["Sí", "No", "Un poco"] },
                { pregunta: "¿Sabes a dónde acudir o qué hacer si tuvieras un problema con las apuestas?", opciones: ["Sí", "No"] },
                { pregunta: "¿Has visto anuncios de apuestas en línea en redes sociales o internet?", opciones: ["Sí, muchas veces", "Algunas veces", "Nunca"] },
                { pregunta: "¿Alguna vez has gastado dinero en un juego (ej.: para obtener monedas, vidas o recompensas)?", opciones: ["Sí", "No"] }
            ],
            en: [
                { pregunta: "Age: select range", opciones: ["12 – 13", "14 – 15", "16 – 17"] },
                { pregunta: "Gender", opciones: ["Female", "Male", "Other"] },
                { pregunta: "Have you ever bet online?", opciones: ["Yes", "No"] },
                { pregunta: "How often do you usually bet?", opciones: ["1 to 2 days per week", "3 to 5 days per week", "6 to 7 days per week"] },
                { pregunta: "How many hours do you bet per day?", opciones: ["Less than 1 hour", "1 to 2 hours", "More than 3 hours"] },
                { pregunta: "Which days of the week do you usually bet?", opciones: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"] },
                { pregunta: "What type of activities do you bet on?", opciones: ["Online casino", "Sports betting", "Poker or other card games", "Games of chance (roulette, slots, etc.)", "Other"] },
                { pregunta: "Are the betting sites you play on official (.bet)?", opciones: ["Yes", "No", "I don't know"] },
                { pregunta: "Where do you get the money to bet?", opciones: ["A relative", "Work", "Scholarships", "Other"] },
                { pregunta: "How much money do you usually bet in a week?", opciones: ["Between $1,000 and $5,000", "Between $5,000 and $10,000", "More than $10,000"] },
                { pregunta: "Do your parents or guardians know you bet?", opciones: ["Yes", "No", "I'm not sure"] },
                { pregunta: "How did you learn about online games?", opciones: ["Social networks", "Friends", "Family", "Other"] },
                { pregunta: "Why do you bet?", opciones: ["Fun or entertainment", "To earn money", "Because my friends do it", "Other"] },
                { pregunta: "Do you know the risks of betting?", opciones: ["Yes", "No"] },
                { pregunta: "Do you know where to go or what to do if you had a problem with betting?", opciones: ["Yes", "No"] },
                { pregunta: "Would you like to receive information about it?", opciones: ["Yes", "No"] },
                { pregunta: "Do you know someone who bets online?", opciones: ["Yes", "No"] },
                { pregunta: "Has anyone ever recommended you to bet?", opciones: ["Yes", "No"] },
                { pregunta: "Would you like to bet someday?", opciones: ["Yes", "No", "I'm not sure"] },
                { pregunta: "Do you know the risks of betting?", opciones: ["Yes", "No", "A little"] },
                { pregunta: "Do you know where to go or what to do if you had a problem with betting?", opciones: ["Yes", "No"] },
                { pregunta: "Have you seen online betting ads on social networks or the internet?", opciones: ["Yes, many times", "Sometimes", "Never"] },
                { pregunta: "Have you ever spent money on a game (e.g., to get coins, lives or rewards)?", opciones: ["Yes", "No"] }
            ],
            zh: [
                { pregunta: "年龄：请选择范围", opciones: ["12 – 13", "14 – 15", "16 – 17"] },
                { pregunta: "性别", opciones: ["女性", "男性", "其他"] },
                { pregunta: "你曾经在线上赌博过吗？", opciones: ["是", "否"] },
                { pregunta: "你通常多久赌博一次？", opciones: ["每周1-2天", "每周3-5天", "每周6-7天"] },
                { pregunta: "你每天赌博多少小时？", opciones: ["少于1小时", "1到2小时", "超过3小时"] },
                { pregunta: "你通常在哪些星期几赌博？", opciones: ["星期一", "星期二", "星期三", "星期四", "星期五", "星期六", "星期日"] },
                { pregunta: "你参与哪些类型的赌博活动？", opciones: ["在线赌场", "体育博彩", "扑克或其他纸牌游戏", "机会游戏（轮盘、老虎机等）", "其他"] },
                { pregunta: "你玩的赌博网站是官方的吗（.bet）？", opciones: ["是", "否", "不知道"] },
                { pregunta: "你从哪里获得赌博资金？", opciones: ["亲属", "工作", "奖学金", "其他"] },
                { pregunta: "你一周通常赌博多少钱？", opciones: ["$1,000-$5,000", "$5,000-$10,000", "超过$10,000"] },
                { pregunta: "你的父母或监护人知道你赌博吗？", opciones: ["是", "否", "不确定"] },
                { pregunta: "你是如何了解线上游戏的？", opciones: ["社交网络", "朋友", "家庭", "其他"] },
                { pregunta: "你为什么赌博？", opciones: ["娱乐", "赚钱", "因为朋友也赌博", "其他"] },
                { pregunta: "你知道赌博的风险吗？", opciones: ["是", "否"] },
                { pregunta: "如果你在赌博中遇到问题，你知道该去哪里或该怎么办吗？", opciones: ["是", "否"] },
                { pregunta: "你想收到相关信息吗？", opciones: ["是", "否"] },
                { pregunta: "你认识有人在线赌博吗？", opciones: ["是", "否"] },
                { pregunta: "有人曾经推荐你赌博吗？", opciones: ["是", "否"] },
                { pregunta: "你想过有一天去赌博吗？", opciones: ["是", "否", "不确定"] },
                { pregunta: "你知道赌博的风险吗？", opciones: ["是", "否", "有一点"] },
                { pregunta: "如果你在赌博中遇到问题，你知道该去哪里或该怎么办吗？", opciones: ["是", "否"] },
                { pregunta: "你在社交网络或互联网上见过线上赌博广告吗？", opciones: ["是，经常", "有时", "从未"] },
                { pregunta: "你曾经在游戏中花钱吗（例如：购买金币、生命或奖励）？", opciones: ["是", "否"] }
            ]
        };

        const questions = [
            { pregunta: "Edad: seleccionar rango", tipo: "opcion", opciones: ["12 – 13", "14 – 15", "16 – 17"] },
            { pregunta: "Género", tipo: "opcion", opciones: ["Femenino", "Masculino", "Otro"] },
            { pregunta: "¿Has apostado en línea alguna vez?", tipo: "opcion", opciones: ["Sí", "No"] },
            { pregunta: "¿Con qué frecuencia sueles apostar?", tipo: "opcion", opciones: ["1 a 2 días por semana", "3 a 5 días por semana", "6 a 7 días por semana"] },
            { pregunta: "¿Cuántas horas apostás por día?", tipo: "opcion", opciones: ["Menos de 1 hora", "1 a 2 horas", "Más de 3 horas"] },
            { pregunta: "¿Qué días de la semana sueles apostar?", tipo: "multiple", opciones: ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo"] },
            { pregunta: "¿En qué tipo de actividades apuestas?", tipo: "multiple", opciones: ["Casino online", "Apuestas deportivas", "Póker u otros juegos de cartas", "Juegos de azar (ruleta, tragamonedas, etc.)", "Otro"] },
            { pregunta: "¿Los sitios de apuestas en los que juegas son oficiales (.bet)?", tipo: "opcion", opciones: ["Sí", "No", "No sé"] },
            { pregunta: "¿De dónde obtienes el dinero para apostar?", tipo: "multiple", opciones: ["Un familiar", "Trabajo", "Becas", "Otro"] },
            { pregunta: "¿Cuánto dinero sueles apostar en una semana?", tipo: "opcion", opciones: ["Entre $1.000 y $5.000", "Entre $5.000 y $10.000", "Más de $10.000"] },
            { pregunta: "¿Tus padres o tutores saben que apuestas?", tipo: "opcion", opciones: ["Sí", "No", "No estoy seguro"] },
            { pregunta: "¿Cómo conociste los juegos en línea?", tipo: "multiple", opciones: ["Redes sociales", "Amigos", "Familia", "Otro"] },
            { pregunta: "¿Por qué apuestas?", tipo: "opcion", opciones: ["Diversión o entretenimiento", "Para ganar dinero", "Porque mis amigos lo hacen", "Otro"] },
            { pregunta: "¿Conoces los riesgos de apostar?", tipo: "opcion", opciones: ["Sí", "No"] },
            { pregunta: "¿Sabes a dónde acudir o qué hacer si tuvieras un problema con las apuestas?", tipo: "opcion", opciones: ["Sí", "No"] },
            { pregunta: "¿Te gustaría recibir información al respecto?", tipo: "opcion", opciones: ["Sí", "No"] },
            { pregunta: "¿Conoces a alguien que apueste en línea?", tipo: "opcion", opciones: ["Sí", "No"] },
            { pregunta: "¿Alguien te ha recomendado apostar alguna vez?", tipo: "opcion", opciones: ["Sí", "No"] },
            { pregunta: "¿Te gustaría apostar algún día?", tipo: "opcion", opciones: ["Sí", "No", "No estoy seguro"] },
            { pregunta: "¿Conoces los riesgos de apostar?", tipo: "opcion", opciones: ["Sí", "No", "Un poco"] },
            { pregunta: "¿Sabes a dónde acudir o qué hacer si tuvieras un problema con las apuestas?", tipo: "opcion", opciones: ["Sí", "No"] },
            { pregunta: "¿Has visto anuncios de apuestas en línea en redes sociales o internet?", tipo: "opcion", opciones: ["Sí, muchas veces", "Algunas veces", "Nunca"] },
            { pregunta: "¿Alguna vez has gastado dinero en un juego (ej.: para obtener monedas, vidas o recompensas)?", tipo: "opcion", opciones: ["Sí", "No"] }
        ];

           // Mapeo de preguntas (index 0-22) a keys en inglés para el JSON/BD
   const fieldMapping = {
       0: 'age_range',
       1: 'gender',
       2: 'ever_bet_online',
       3: 'betting_frequency',
       4: 'hours_per_day',
       5: 'betting_days',
       6: 'betting_activities',
       7: 'official_sites',
       8: 'money_sources',
       9: 'weekly_bet_amount',
       10: 'parents_know',
       11: 'how_discovered_online_games',
       12: 'reasons_for_betting',
       13: 'know_betting_risks',
       14: 'know_where_to_seek_help',
       15: 'want_information',
       16: 'knows_someone_who_bets',
       17: 'recommended_to_bet',
       18: 'want_to_bet_someday',
       19: 'know_risks_level',
       20: 'know_help_for_problems',
       21: 'seen_betting_ads',
       22: 'spent_money_on_games'
   };
   
        let currentQuestionIndex = 0;
        let answers = {};
        let questionFlow = [0, 1, 2]; // Always start with first 3 questions
        let currentLang = 'es';
        let surveyStarted = false;  // Para bloquear cambio de idioma después de empezar
        let currentFlowIndex = 0;

           function cambiarIdioma(lang) {
       if (surveyStarted) {
           const alertText = {
               es: 'No puedes cambiar el idioma una vez iniciada la encuesta.',
               en: 'You cannot change the language once the survey has started.',
               zh: '调查开始后不能更改语言。'
           };
           alert(alertText[currentLang]);
           document.getElementById('lang').value = currentLang;  // Revierte
           return;
       }
       currentLang = lang;
       mostrarPregunta();
   }
   

        function getQuestionText(questionIndex) {
            if (currentLang === 'es') {
                return questions[questionIndex];
            } else {
                return {
                    pregunta: traducciones[currentLang][questionIndex].pregunta,
                    tipo: questions[questionIndex].tipo,
                    opciones: traducciones[currentLang][questionIndex].opciones
                };
            }
        }

        function updateQuestionFlow() {
    const question3Answer = answers[2];
    const newFlow = [0, 1, 2];
    
    if (question3Answer === "Sí" || question3Answer === "Yes" || question3Answer === "是") {
        // Path "Sí": Full flow 3-22 (todas las preguntas)
        for (let i = 3; i <= 22; i++) {
            newFlow.push(i);
        }
    } else {
        // Path "No": Salta 3-15, va directo a 16-22
        for (let i = 16; i <= 22; i++) {
            newFlow.push(i);
        }
    }
    
    questionFlow = newFlow;
}
           function mostrarPregunta() {
       surveyStarted = true;
       const realQuestionIndex = questionFlow[currentFlowIndex];
       const questionData = getQuestionText(realQuestionIndex);
       
       let html = `<h2>${questionData.pregunta}</h2>`;
       
       // Show multi-select info for multiple choice questions
       if (questionData.tipo === 'multiple') {
           const multiSelectText = {
               es: 'Puedes seleccionar múltiples opciones',
               en: 'You can select multiple options',
               zh: '您可以选择多个选项'
           };
           html += `<div class="multi-select-info">${multiSelectText[currentLang]}</div>`;
       }
       
       questionData.opciones.forEach((opcion, i) => {
           const isSelected = isOptionSelected(realQuestionIndex, opcion);
           html += `<div class="option ${isSelected ? 'selected' : ''}" onclick="seleccionarOpcion(${realQuestionIndex}, '${opcion}', '${questionData.tipo}')">${opcion}</div>`;
       });
       
       html += '<div class="button-group">';
       
       // Back button
       if (currentFlowIndex > 0) {
           const backText = {
               es: 'Anterior',
               en: 'Previous',
               zh: '上一个'
           };
           html += `<button class="back-btn" onclick="anteriorPregunta()">${backText[currentLang]}</button>`;
       }
       
       // Siempre botón "Siguiente" (envío automático al final del flow)
       const nextText = {
           es: 'Siguiente',
           en: 'Next',
           zh: '下一个'
       };
       html += `<button onclick="siguientePregunta()">${nextText[currentLang]}</button>`;
       
       html += '</div>';  // Cierre del button-group (fuera del if)
       
       document.getElementById('quiz').innerHTML = html;
       actualizarProgreso();
   }
   

        function isOptionSelected(questionIndex, option) {
            const answer = answers[questionIndex];
            if (Array.isArray(answer)) {
                return answer.includes(option);
            }
            return answer === option;
        }

        function seleccionarOpcion(questionIndex, opcion, tipo) {
            if (tipo === 'multiple') {
                if (!answers[questionIndex]) {
                    answers[questionIndex] = [];
                }
                
                const currentAnswers = answers[questionIndex];
                const index = currentAnswers.indexOf(opcion);
                
                if (index > -1) {
                    currentAnswers.splice(index, 1);
                } else {
                    currentAnswers.push(opcion);
                }
            } else {
                answers[questionIndex] = opcion;
            }
            
            mostrarPregunta();
        }

        function validarRespuesta() {
            const realQuestionIndex = questionFlow[currentFlowIndex];
            const questionData = getQuestionText(realQuestionIndex);
            const answer = answers[realQuestionIndex];
            
            if (questionData.tipo === 'multiple') {
                return Array.isArray(answer) && answer.length > 0;
            } else {
                return answer !== undefined && answer !== '';
            }
        }

          function siguientePregunta() {
       if (!validarRespuesta()) {
           const alertText = {
               es: 'Por favor selecciona una opción',
               en: 'Please select an option',
               zh: '请选择一个选项'
           };
           alert(alertText[currentLang]);
           return;
       }
       
       const realQuestionIndex = questionFlow[currentFlowIndex];
       
       // Update flow after answering question 3
       if (realQuestionIndex === 2) {
           updateQuestionFlow();
       }
       
       currentFlowIndex++;
       
       if (currentFlowIndex >= questionFlow.length) {
           enviarEncuesta();  // ¡CAMBIO: Envía datos al final de cualquier path (Sí o No)
       } else {
           mostrarPregunta();
       }
   }
   
          
         
        function anteriorPregunta() {
            if (currentFlowIndex > 0) {
                currentFlowIndex--;
                mostrarPregunta();
            }
        }

         // Función para enviar datos al webhook de n8n (mapea a keys en inglés, preserva idioma)
   async function enviarEncuesta() {
       if (!validarRespuesta()) {
           const alertText = {
               es: 'Por favor selecciona una opción',
               en: 'Please select an option',
               zh: '请选择一个选项'
           };
           alert(alertText[currentLang]);
           return;
       }

       // Mapear answers a JSON con keys en inglés (respuestas en idioma actual)
       let data = { language: currentLang };  // Track idioma
       for (let i = 0; i <= 22; i++) {  // 23 preguntas (0-22)
       let englishKey = fieldMapping[i];
       if (englishKey) {
           // Manejar salto lógico: si pregunta 3 (index 2) es "No" en el idioma actual, nulls para 3-15
           const everBet = answers[2];
           const noValues = {
               es: 'No',
               en: 'No',
               zh: '否'
           };
           const isNoPath = everBet === noValues[currentLang];
           if (i >= 3 && i <= 15 && isNoPath) {
               data[englishKey] = null;
           } else {
               let rawValue = answers[i];
               if (rawValue === undefined) {
                   data[englishKey] = null;
               } else if (Array.isArray(rawValue)) {
                   data[englishKey] = rawValue;  // Array para multiple
               } else {
                   data[englishKey] = rawValue || "";  // String en idioma actual
               }
           }
       }
   }
       data.timestamp = new Date().toISOString();  // Timestamp

       // Log para depuración (F12 Console)
       console.log('JSON enviado (keys en inglés, respuestas en idioma):', data);

       if (!N8N_WEBHOOK_URL) {
           console.error('N8N_WEBHOOK_URL no configurada.');
           mostrarMensajeFinal(false, 'URL no configurada.');  // Error simulado
           return;
       }

       try {
           const response = await fetch(N8N_WEBHOOK_URL, {
               method: 'POST',
               mode: 'cors',  // Para cross-origin (GitHub a ngrok/server)
               headers: {
                   'Content-Type': 'application/json',
               },
               body: JSON.stringify(data)
           });

           if (!response.ok) {
               throw new Error(`HTTP ${response.status}: ${response.statusText}`);
           }

           const result = await response.json();
           if (result && (result.success || response.ok)) {
               console.log('Éxito real:', result);
               mostrarMensajeFinal(true);  // Éxito
           } else {
               throw new Error('Respuesta del servidor no indica éxito');
           }
       } catch (error) {
           console.error('Error al enviar:', error);
           mostrarMensajeFinal(false, error.message);  // Error
       }
   }
   
           function mostrarMensajeFinal(success = null, errorMsg = '') {
       const finalMessages = {
           es: `
               <h2>Gracias por responder esta encuesta</h2>
               <div class="final-message">
                   <p>Si querés o necesitás más información sobre el tema podés:</p>
           `,
           en: `
               <h2>Thank you for answering this survey</h2>
               <div class="final-message">
                   <p>If you want or need more information about the topic you can:</p>
           `,
           zh: `
               <h2>感谢您参与本次调查</h2>
               <div class="final-message">
                   <p>如需更多信息，请：</p>
           `
       };

       let html = finalMessages[currentLang];

       // Insertar mensaje de éxito o error
       if (success === true) {
           html += `
               <div style="background: #d4edda; color: #155724; padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px solid #c3e6cb;">
                   <strong>¡Éxito!</strong> Tus respuestas se enviaron correctamente.
               </div>
           `;
       } else if (success === false) {
           html += `
               <div style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px solid #f5c6cb;">
                   <strong>Error en el envío:</strong> ${errorMsg}. Puedes reintentar o contactar al administrador.
                   <button onclick="enviarEncuesta()" style="margin: 5px; background: #2575fc; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;">Reintentar</button>
               </div>
           `;
       }

       html += `
                   <ul style="text-align:left;">
                       <li>Ingresar a <a href="https://www.saberjugar.gob.ar" target="_blank">https://www.saberjugar.gob.ar</a></li>
                       <li>Centros de ayuda municipal en Chascomús:</li>
                       <ul style="text-align:left; margin-left: 20px; list-style-type: disc;">
                           <li>Centro de Día Chascomús, Dirección Carmona 36, Barrio 30 de Mayo, Tel: 02241-409070, Horarios de Atención de Lunes a Viernes de 08 a 14hs.</li>
                           <li>Centro de Prevención de las Adicciones, Carmona 36, Barrio 30 de Mayo, Horarios de Atención de 09 a 14 hs, Tel: 02241-400278.</li>
                       </ul>
                       <li>Por Urgencias llamar al <b>107</b></li>
                   </ul>
                   ${success === false ? '<button onclick="location.reload()" style="margin-top: 10px; background: #ddd; color: #333; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;">Recargar y Responder de Nuevo</button>' : ''}
               </div>
           `;

       document.getElementById('progress').style.width = '100%';
       document.getElementById('quiz').innerHTML = html;
   }
   
        function actualizarProgreso() {
            const progreso = ((currentFlowIndex + 1) / questionFlow.length) * 100;
            document.getElementById('progress').style.width = progreso + '%';
        }

        // Initialize
        mostrarPregunta();
    </script>
</body>
</html>








